<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>出版单品页</title>
	<link type="text/css" rel="stylesheet" href="http://static.dangdang.com/css/win_login20150728.css?20150817">
	<link type="text/css" rel="stylesheet" href="css/common.min.css">
	<link type="text/css" rel="stylesheet" href="css/product_page.min.css">
</head>
<body>
	{(head.html)}
	<!-- 导航开始 -->
	<div class="public_headernav_module padding_top_30" dd_name="头部导航">
	    <div class="public_headernav_module">
			<div class="nav">
				<ul>
					<li class="on"><a href="http://k.dangdang.com/staging/index_page.html">首页</a></li>
					<li class="chubannav"><a href="http://k.dangdang.com/staging/publish_index_page.html">出版</a></li>
					<li class="yuanchuangnav"><a href="http://k.dangdang.com/staging/original_index_page.html?originalSex=man">原创</a></li>
					<li><a href="http://k.dangdang.com/staging/product_page.html?id=1900098227&mediaId=1900098227&mediaType=2#">众筹</a></li>
					<li><a href="http://k.dangdang.com/staging/product_page.html?id=1900098227&mediaId=1900098227&mediaType=2#">手机看书</a></li>
				</ul>
			</div>
		</div>
	</div>
	<!-- 导航结束 -->
	
	<div class="product_conntent_wrap">
		<div class="product_content clearfix">
			 <!-- 面包屑开始 -->
			 <div class="navigation_module" id="crumb" dd_name="面包屑">
				<a href="index_page.html">当当读书</a>
				<a href="classification_list_page.html?category={{media_model.data.mediaSale.mediaList[1].categoryIds}}&dimension=dd_sale">{{media_model.data.mediaSale.mediaList[1].categorys}}</a>
				<a class="focus">{{media_model.data.mediaSale.mediaList[1].title}}</a>
			 </div>
			 <!-- 面包屑结束 -->
			 
			<!-- 左侧开始 -->
			<div class="product_content_left">
				<!-- 书本信息开始 -->
				<div class="product_bookdetail_module clearfix" id="productBookDetail" dd_name="书本信息">
					<!-- 封面 -->
					<div class="bookcover">
						<img onerror="this.src='img/book_def_180_260.png'" src="{{media_model.data.mediaSale.mediaList[1].coverPic}}" />
					</div>
					
					<div class="bookinfor">
						<div class="title">
							{{media_model.data.mediaSale.mediaList[1].title}}
							<span class="icon">电子书</span>
						</div>
						
						<div class="star">
							<span class="starlevel">
								{% local score = media_model.data.mediaSale.mediaList[1].score 
									if score ~= 5 then
									local classname = "starlevel_inner_"..score %}
									<span class="starlevel_inner {{classname}}"></span>
								{% else %}
									<span class="starlevel_inner"></span>
								{% end %}							
							</span>
							<i class="num" id="postNum">
							{% local barInfo = article_model.data.barInfo 
								if barInfo ~= nil then %}   
								({{article_model.data.barInfo.articleNum}}人评论)
								{% else %}
								(0人评论)
								{% end %}
							</i>
						</div>
						
						<ul class="publish_infor">
							<li>作&nbsp; 者 ：{{media_model.data.mediaSale.mediaList[1].authorPenname}}</li>
							{% local wordCount = media_model.data.mediaSale.mediaList[1].wordCnt 
								if  wordCount > 10000 then
									wordCount = string.format("%.1f", wordCount/10000).."万"
								end %}
							<li>字&nbsp; 数 ：{{wordCount}}</li>
							<li>出版社：&nbsp;{{media_model.data.mediaSale.mediaList[1].publisher}}</li>
						</ul>
						
						<div class="price_line">
							{% 
								local priceStr, bellStr, paperpriceStr, discountStr = "", "", "", ""
								local paperMediaPrice = media_model.data.mediaSale.mediaList[1].paperMediaPrice
								local price = media_model.data.mediaSale.mediaList[1].price
								if media_model.data.mediaSale.mediaList[1].freeBook == 1 then
									priceStr = "免费"
									bellStr= "免费"
									if paperMediaPrice then
										paperpriceStr = "¥"..string.format("%.2f", (paperMediaPrice/100))
									end
								else
									if media_model.data.mediaSale.mediaList[1].mediaType == 2 then
										bellStr = price
										priceStr = "¥"..string.format("%.2f", (price/100))
										if paperMediaPrice then
											paperpriceStr = "¥"..string.format("%.2f", paperMediaPrice/100)
											local discountNum = string.format("%.1f", (price/paperMediaPrice)*10)
											if (1 > tonumber(discountNum)) then
												discountStr = "低于1折"
											else
												discountStr = discountNum.."折"
											end
										end										
									end
								end
							%}
							<span class="red">{{priceStr}}</span>
							<b>|</b>
							<span class="red"><i class="icon bell"></i>{{bellStr}}</span>						
							{% if paperpriceStr ~= "" then %}
								<b>|</b><span class="paperbook">纸书标价：{{paperpriceStr}}</span>
							{% end %}		
							{% if discountStr ~= "" then %}
								<b>|</b><span class="red percent_off">{{discountStr}}</span>
							{% end %}													
						</div>
											
						<div class="btn_line">
							{% local link = "http://e.dangdang.com/pc/reader/index.html?id="..media_model.data.mediaSale.mediaList[1].mediaId %}
							{% if media_model.data.mediaSale.mediaList[1].freeBook == 1 then 
								if media_model.data.mediaSale.mediaList[1].isWholeAuthority == 1 then %}
									<a href="{{link}}" class="btn" status="readNow" target="_blank" id="readNow" dd_name="立即阅读">立即阅读</a>
								{% else %}
									<a href="javascript:;" class="btn" status="free" id="freeGet" dd_name="免费获取">免费获取</a>
								{% end %}
							{% else 
								local borrowEndTime = media_model.data.mediaSale.mediaList[1].borrowEndTime
								if media_model.data.mediaSale.mediaList[1].canBorrow == 1 then
									local duration = media_model.data.mediaSale.mediaList[1].borrowDuration
									local durDay = duration/1000/60/60/24
									if borrowEndTime == nil or borrowEndTime == "" then %}
										<a href="javascript:;" class="btn" status="borrow" dur ="{{duration}}" id="borrowBtn" dd_name="免费借阅">免费借阅({{durDay}}天)</a>
										<a href="javascript:;" class="btn_orange" status="buy" id="buy_now_button" deviceTypeCodes="{{media_model.data.mediaSale.mediaList[1].deviceTypeCodes}}" dd_name="购买">购买</a>
										<a href="##" class="shopping_car addShopCartBtn btn_basic" id="addShopCartBtn" dd_name="加入购物车">加入购物车</a>
									{% else 
										if ( borrowEndTime - (ngx.now * 1000)) > 0 then %}	
											<a href="{{link}}" class="btn" status="readNow" target="_blank" id="readNowBtn" dd_name="立即阅读">立即阅读</a>
										{% else %}
											<a href="javascript:;" class="btn" status="reborrow" id="reborrowBtn" dd_name="续借" >续借</a>
											<a href="javascript:;" class="btn_orange" status="buy" id="buy_now_button" deviceTypeCodes="{{media_model.data.mediaSale.mediaList[1].deviceTypeCodes}}" dd_name="购买">购买</a>
											<a href="##" class="shopping_car addShopCartBtn btn_basic" id="addShopCartBtn" dd_name="加入购物车">加入购物车</a>
										{% end %}							
									{% end %}								
								{% else
									if media_model.data.mediaSale.mediaList[1].isWholeAuthority == 1 then %}
										<a href="{{link}}" class="btn" status="readNow" target="_blank" id="readNowBtn" dd_name="立即阅读">立即阅读</a>									
									{% else %}
										<a href="{{link}}" class="btn" status="try" target="_blank" id="tryBtn" dd_name="试读">试读</a>
										<a href="javascript:;" class="btn_orange" status="buy" id="buy_now_button" deviceTypeCodes="{{media_model.data.mediaSale.mediaList[1].deviceTypeCodes}}" dd_name="购买">购买</a>
										<a href="##" class="shopping_car addShopCartBtn btn_basic" id="addShopCartBtn" dd_name="加入购物车">加入购物车</a>
									{% end %}			
								{% end %}									
							{% end %}
							<span class="collectSpan clearfix" id="collectC" data-isStore="{{media_model.data.mediaSale.mediaList[1].isStore}}"" dd_name="收藏"></span>
							<span class="shareSpan"><div id="ShareC" dd_name="分享"></div></span>
							<a href="javascript:;" class="phone" dd_name="在手机上阅读">
								<span class="phone_inner"><i class="icon"></i>在手机上阅读</span>
								<div class="ecode"><span class="arrow"></span><img src="img/ecode.png" alt=""></div>
							</a>						
						</div>
					</div>
					<input id="productId" type="hidden" value="{{media_model.data.mediaSale.mediaList[1].mediaId}}" />
					<input id="saleId" type="hidden" value="{{media_model.data.mediaSale.mediaList[1].saleId}}" />
				</div>
				<!-- 书本信息结束 -->
				
				<!-- 作品介绍、目录、关于作者、更多信息 -->
				<div class="product_bookinfor_module" id="bookInfo" dd_name="作品相关信息">
					<div class="product_infortitle_module">
						<ul class="nav clearfix">
							<li class="first on"><a href="javascript:;">作品介绍</a></li>
							<li><a href="javascript:;">目录</a></li>
							<li><a href="javascript:;">更多信息</a></li>
						</ul>
						<div class="bar"></div>
					</div>
					{%	
						local desStr = media_model.data.mediaSale.mediaList[1].descs 
						local desc_finl_str = string.gsub(desStr, "%s+", "") %}
						<div class="content bookDes"><div class="bookDes_inner">&nbsp;&nbsp;&nbsp;&nbsp;{{desc_finl_str}}</div></div>
						<!-- 图书章节内容 -->
						<div class="content catalog_box" id="catalogBox" style="display:none;">
							{%	local media_catalog = publish_content_model.data.contents
								if type(media_catalog) == "table" and media_catalog ~= nil then %}
								<ul class="catalog_ul">
									{% for k, v in pairs(media_catalog) do %}
										<li class="catalog_li">
											<h3 class="catalog_h3">{{v["name"]}}</h3>
											<div class="catalog_div">{{v["content"]}}</div>
										</li>
									{% end %}							
								</ul>
								{% else %}
									<div class="no_catalog">此书没有目录，精彩内容尽在阅读中</div>
								{% end %}
						</div>
						<div class="content more" style="display:none;">
							<p><b>出版社：</b>{{media_model.data.mediaSale.mediaList[1].publisher}}</p>
							<p><b>出版时间：</b>{{os.date("%Y-%m-%d", media_model.data.mediaSale.mediaList[1].publishDate/1000)}}</p>
							<p><b>ISBN：</b>{{media_model.data.mediaSale.mediaList[1].isbn}}</p>
							{% local wordCount = media_model.data.mediaSale.mediaList[1].wordCnt 
								if  wordCount > 10000 then
									wordCount = string.format("%.1f", wordCount/10000).."万"
								end %}
							<p><b>字数：</b>{{wordCount}}</p>
							<p><b>大小：</b>{{string.format("%.1f", (media_model.data.mediaSale.mediaList[1].fileSize/1048576))}}M</p>							
						</div>
				</div>
				
				
				<!-- 买了还买 -->
				<div class="product_alsobuy_module" dd_name="买了还买">
					<div class="clearfix" id="bookAlsoBuy">
						<div class="product_rectitle_module">买过这本书的人还买过</div>
						{% if buy_also_buy_model ~= nil and 
							buy_also_buy_model.data.mediaList ~= nil and 
							type(buy_also_buy_model.data.mediaList) == "table" then 
							for k, v in pairs(buy_also_buy_model.data.mediaList) do %}
								<div class="product_alsobuycell_module">
									{%  local mediaType = v["mediaType"] 
										local coverPic = v["coverPic"]
										local title = v["title"]
										local link
										if mediaType == 1 then
											link = "http://k.dangdang.com/staging/original_single_page.html?id="..v["saleId"].."&mediaId="..v["mediaId"].."&mediaType=1"
										elseif mediaType == 2 then
											link = "http://k.dangdang.com/staging/product_page.html?id="..v["saleId"].."&mediaId="..v["mediaId"].."&mediaType=2"
										end %}
										<div class="bookcover"><a href="{{link}}" target="_blank"><img onerror = "javascript:nofind(this,\'img/book_def_74_105.png\');" src="{{coverPic}}" /></a></div>
										<p class="title"><a href="{{link}}" target="_blank" title="{{title}}">{{title}}</a></p>
										<p class="price">
											<!-- TODO price -->
										</p>										
								</div>							
							{% end 					
						end %}
					</div>					
				</div>
				
				<!-- 书吧开始 -->
				<div class="product_bar_module" id="barModule" dd_name="书吧">
					<!-- 吧相关信息 -->
					<div class="product_barcell_moudle clearfix" id="bar">
						<div class="header">
							<p>{{article_model.data.barInfo.barName}}书吧</p>
							<div class="bar"></div>
						</div>
						<div class="inner clearfix">
							<div class="pic">
								<div class="pic_wrap"><img src="{{article_model.data.barInfo.barImgUrl}}" alt=""></div>
								<div class="name">吧主</div>
							</div>
							<div class="desc">
								{% local link = "bar_detail_page.html?barId="..article_model.data.barInfo.barId %}
								<h1 class="title"><a href="{{link}}">{{article_model.data.barInfo.barName}}</a></h1>
								<div class="content"><a href="{{link}}">{{article_model.data.barInfo.barDesc}}</a></div>
							</div>
							<div class="fans clearfix">
								<div class="fans_num">
									<i class="icon icon_size_50"></i>
									<p class="num">粉丝{{article_model.data.barInfo.memberNum}}</p>
								</div>
								<a class="bar_write_btn" href="javascript:;" memberStatus="{{article_model.data.barInfo.memberStatus}}" barId="{{article_model.data.barInfo.barId}}" >发帖</a>
								<a class="read_more_post" href="bar_detail_page.html?barId={{article_model.data.barInfo.barId}}" target="_blank">查看全部帖子</a>								
							</div>
							<div class="masks" id="mask"></div>
							<div class="pop_enter_wrap" id="enterBar">
								<div class="opacity_border"></div>
								<div class="pop_enter">
									<img src="img/pop_enter_bar.jpg" alt="">
									<p class="pop_btn_line"><a href="javascript:;" class="no pop_btn" status="0">取消</a><a href="javascript:;" class="yes pop_btn" status="1" barId="{{article_model.data.barInfo.barId}}" >加入</a></p>
								</div>
							</div>
						</div>
					</div>
					<!-- 吧评论 -->
					<div id="barposts">
						{%  local posts = article_model.data.articleList 
							if posts ~= nil and type(posts) == "table" then 
								for k, v in pairs(posts) do  
									local barId = v["barId"] 
									local digestId = v["mediaDigestId"] 
									local link = "post_detail_page.html?barId="..barId.."&digestId="..digestId
									local user = v["userBaseInfo"]								
									if k < 4 then %}
										<div class="product_barposts_module clearfix">
											<div class="pic">
												<img src="{{user.custImg}}" alt="">
												<div class="name">{{user.nickName}}</div>
												<div class="time">{{os.date("%Y-%m-%d", v["createDateLong"]/1000)}}</div>
											</div>
											<div class="desc">
												<div class="post_con">
													<h1 class="title"><a href="{{link}}" target="_blank">{{v["title"]}}</a></h1>
													<div class="content">
														<div class="brief"> <a href="{{link}}" class="left" target="_blank">{{v["content"]}}</a></div>		
													</div>
													{% if v["imgList"] ~= nil and v["imgList"] ~= "" then %}
														<ul class="pic_list clearfix">
															{% for key, val in pairs(v["imgList"]) do 
																if (key < 3) then %}
																	<li><a href="{{link}}" target="_blank"><img src="{{val}}" alt=""></a></li>												
																{% end
															end %}
														</ul>
													{% end %}																					
												</div>
												<div class="community clearfix">
													<a href="javascript:;" class="favor" data-praise="false" digestId="{{digestId}}" >
														<i class="icon icon_size_20"></i>
														<em class="praise_num">{{v["praiseNum"]}}</em>
													</a>
													<a href="{{link}}" target="_blank" class="comment">
														<i class="icon icon_size_20"></i>
														<em>{{v["commentNum"]}}</em>
													</a>
												</div>
											</div>											
										</div>
									{% end %}
									{% if k == 3 then %}
										<div class="product_barmore_module"><a href="bar_detail_page.html?barId={{barId}}" target="_blank">去看更多帖子</a></div>									
									{% end
								end
							end %}						
					</div>				
				</div>
				<!-- 书吧结束 -->
				
			</div>
			<!-- 左侧结束 -->
			
				
			<!-- 右侧开始 -->
			<div class="product_content_right">
				<!-- 强力推荐 -->
				<div class="product_rec_wrapper"  dd_name="强力推荐">
					<div id="recommend">
						<div class="product_rectitle_module">强力推荐</div>
						
						
						
					</div>
				</div>
				
				<!-- 移动阅读设备 -->
				<div class="product_device_module">
					<h3>移动阅读设备</h3>
					<ul class="clearfix">
						<li class="device_01">
							<a href="">
								<em  class="icon_line"><i class="icon icon_size_40"></i></em>
								<em class="words">PC在线</em>
							</a>
						</li>
						<li class="device_02">
							<a href="">
								<em  class="icon_line"><i class="icon icon_size_40"></i></em>
								<em class="words">PC下载</em>
							</a>
						</li>
						<li class="device_03">
							<a href="">
								<em  class="icon_line"><i class="icon icon_size_40"></i></em>
								<em class="words">ipad</em>
							</a>
						</li>
						<li class="device_04">
							<a href="">
								<em class="icon_line"><i class="icon icon_size_40"></i></em>
								<em class="words">iphone</em>
							</a>
						</li>
						<li class="device_05">
							<a href="">
								<em  class="icon_line"><i class="icon icon_size_40"></i></em>
								<em class="words">Andriod</em>
							</a>
						</li>
						<li class="device_06">
							<a href="">
								<em  class="icon_line"><i class="icon icon_size_40"></i></em>
								<em class="words">阅读器</em>
							</a>
						</li>
						<li class="device_07">
							<a href="">
								<em  class="icon_line"><i class="icon icon_size_40"></i></em>
								<em class="words">触屏版</em>
							</a>
						</li>
						<li class="device_08">
							<a href="">
								<em  class="icon_line"><i class="icon icon_size_40"></i></em>
								<em class="words">都看阅读器触屏版</em>
							</a>
						</li>
						<li class="device_09">
						</li>
					</ul>
				</div>
				
				<!-- 大家都在看 -->
				<div class="product_rec_wrapper" dd_name="大家都在看">
					 <!-- <div class="product_rectitle_module">大家都在看</div> -->
					 <div id="bookAlsoLook">
					 	<!--  <div class="product_reccell_module clearfix">
    <a href="#">
        <div class="bookcover"><img src="images/1.png" /></div>
        <div class="bookinfo">
            <div class="title">把每一天当作梦一座孤岛</div>
            <div class="author">蓝火</div>
            <div class="price"><span class="now"><i class="">¥7.99</i></span>|<span>¥18.00</span></div>
        </div>
    </a>
</div> -->
					 </div>
					 
				</div>
				<!-- 热门频道 -->
				<div class="publish_hot_channel" dd_name="热门频道">
				 <!-- <div class="product_rectitle_module">热门频道</div> -->
				 <div id="hotChannel"></div>
				</div>
			</div>
			<!-- 右侧结束 -->
		</div>	
	</div>
	
	{(foot.html)}
	
	<script type="text/javascript">
        var require = {urlArgs: "v=1453881061684"}
    </script>
	<script type="text/javascript" src="lib/require.min.js" data-main="js/product"></script>
	<script>
		require.config({
　　　　　　baseUrl: "js/",
　　　　　　paths: {
　　　　　　    "jquery": "../lib/jquery.min",
                "underscore": "../lib/underscore.min",
                "backbone": "../lib/backbone.min",
                "loginWindow":"http://static.ddimg.cn/js/login/LoginWindow.js?20150122"
　　　　    },
			shim:{
				'loginWindow': {
	　　　　　　　　deps: ['jquery'],
	　　　　　　　　exports: 'loginWindow'
				}
			}
　　    });
	</script>
	<script type="text/javascript" src="http://click.dangdang.com/js_tracker.js?20150907"></script>
</body>
</html>